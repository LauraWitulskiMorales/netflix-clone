const data = {
  "popularMovies": [
    {
      "title": "Coco",
      "image": "/img/Coco.webp",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Mean Girls",
      "image": "/img/meanG.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Orange is the New Black",
      "image": "/img/oitnb.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Naruto Shippuden",
      "image": "/img/narutoShi.avif",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Grey's Anatomy",
      "image": "/img/gA.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ],
  "recommendedMovies": [
    {
      "title": "Barbie",
      "image": "https://assets.aboutamazon.com/7f/e6/b76966994e56a97dbeba44f56009/barbie-hero.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Princess Mononoke",
      "image": "https://www.indiewire.com/wp-content/uploads/2020/06/1692841_orig.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Revenant",
      "image": "https://images.cdn.prd.api.discomax.com/2024/02/25/937b7238-3757-3a64-b03d-83f8318a1e79.jpeg?f=jpg&q=75&w=1280&w=1200",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Deadpool",
      "image": "https://img1.hulu.com/user/v3/artwork/e27cac54-3c3c-425e-b7de-67edc2c9f496?base_image_bucket_name=image_manager&base_image=c508266a-667a-4ef8-b770-bfcaaf6d4fd5&size=600x338&format=webp",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Oppenheimer",
      "image": "https://noticiasdel6.com/wp-content/uploads/2023/07/oppenheimer.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ],
  "trendingMovies": [
    {
      "title": "The Rookie",
      "image": "https://s-cdn-sj.eu-central-1.linodeobjects.com/the-rookie/hdtv.webp",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Emily in Paris",
      "image": "https://m.economictimes.com/thumb/msid-109821301,width-1600,height-900,resizemode-4,imgsize-50560/emily-in-paris-season-4-to-be-released-in-two-parts-lily-collins-reveals-official-release-date-teaser.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Uglies",
      "image": "https://occ-0-8407-444.1.nflxso.net/dnm/api/v6/E8vDc_W8CLv7-yMQu8KMEC7Rrr8/AAAABaw9sGyPCVc466bV7uSY7Xar4CepAZOHHogKC92NnaBJFOBqp9Fyg_11fV2CrZZtmc4Wp3AZeMWicrbP6e__xMt-iOHYQKNRDE24.jpg?r=540",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Fast & Furious 6",
      "image": "https://rukminim2.flixcart.com/image/850/1000/poster/q/a/g/large-fast-n-furious-4300-fast-and-furious-6-poster-original-imaes5ksdceqhkg6.jpeg?q=90&crop=false",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Avatar",
      "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRKUQGoJQo_RsEKR7XPLDL2ITg5vLHZvzb7pfmQLNvq9gGoHHWgfqw6YUKkL1dUneMcZpg&usqp=CAU",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ],
  "emotionalMovies": [
    {
      "title": "New Amsterdam",
      "image": "https://images.plus.rtl.de/watch/761169/artwork_landscape/r7-55-az-91/new-amsterdam",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Lost",
      "image": "https://occ-0-8407-444.1.nflxso.net/dnm/api/v6/Qs00mKCpRvrkl3HZAN5KwEL1kpE/AAAABRfKJZBLjFhu-N3tPSxeuzUVStH-JfCr1CBe2QvRiDJ11AS7VTGZwo0FyP04adUemeh59EuzO5NjIUxjzIToRUna1zCAMtCJFkHB.webp?r=edeg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "The Queen's Gambit",
      "image": "https://assets.fontsinuse.com/static/use-media-items/135/134464/upto-700xauto/604cc48d/@2x/QueensGambit_02.png",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Maid",
      "image": "https://occ-0-2773-2774.1.nflxso.net/dnm/api/v6/Qs00mKCpRvrkl3HZAN5KwEL1kpE/AAAABZ3H_TPXA1Z4Qo-qpkAmAJ4SHekxgQIQ8IrdioC9bDLaM4QeUqJiKO-91z0RCLEdESoVLTq6xtBltwPpqSENJw3Smf3g9ml12AWavzDaMOgMaqk8s3jlpXcZFfcsYPPVNdWS.jpg?r=56c",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Fate: The Winx Saga",
      "image": "https://s29288.pcdn.co/wp-content/uploads/2021/02/fate-the-winx-saga-season-1-poster.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ],
  "continueWatching": [
    {
      "title": "Adventure Time",
      "image": "https://pic.rutube.ru/video/25/87/25873ec054e1609ecb6f85421c977a2a.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Brooklyn Nine-Nine",
      "image": "https://wallpapercave.com/wp/wp2473156.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Winx Club",
      "image": "https://dev.winxclub.com/sites/default/files/styles/cover-16-9/public/app/cover/winx_rocks_the_world.jpg?itok=mJBGAxHE",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Kaulitz & Kaulitz",
      "image": "https://bilder.fernsehserien.de/sendung/hr2/kaulitz-und-kaulitz_653364-w-858.png.webp",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Avatar",
      "image": "http://www.sky.de/static/img/program_guide/59557_ser_l.jpg?impolicy=bp04_teaserdata_image_16_9",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ],
  "originalMovies": [
    {
      "title": "The Mandalorian",
      "image": "https://images.alphacoders.com/112/1121346.jpeg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Stranger Things",
      "image": "https://blogcritics.org/wp-content/uploads/2022/06/strager-things-v-4-768x432-crop-600x338-1.webp",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Bridgerton",
      "image": "https://576256f923.cbaul-cdnwnd.com/a8a5e6207f20e8645fac8b0d63f393ac/200000113-c49f0c49f3/bridgerton.webp?ph=576256f923",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Breaking Bad",
      "image": "https://c4.wallpaperflare.com/wallpaper/12/292/881/breaking-bad-tv-wallpaper-preview.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "The Crown",
      "image": "https://hips.hearstapps.com/hbz.h-cdn.co/assets/16/40/1600x800/landscape-1475588380-the-crown-index.jpg?resize=1200:*",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ],
  "newMovies": [
    {
      "title": "Dune",
      "image": "https://img.englishcinemakyiv.com/TZQNHl9QWb3c56UMslK_fYlpRY7l_3tqDBtkc_Ewkxw/resize:fill:800:450:1:0/gravity:sm/aHR0cHM6Ly9leHBhdGNpbmVtYXByb2QuYmxvYi5jb3JlLndpbmRvd3MubmV0L2ltYWdlcy8xYTdiNzYxMy05MWQ5LTQ2YjktYmVkYy1lOGRiMTFlZGE5ZDQuanBn.jpg",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "The Batman",
      "image": "https://images.squarespace-cdn.com/content/v1/51b3dc8ee4b051b96ceb10de/1600041290961-QV53ZKSZMYB9IEIVJRMT/image-asset.jpeg?format=2500w",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Black Widow",
      "impplay": "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/846a9086-8a40-43e0-aa10-2fc7d6d73730/ddoannh-2e079c7f-17ec-422d-9bf1-a7c15db47530.jpg/v1/fill/w_800,h_450,q_75,strp/black_widow__2020__wallpaper__3_by_mintmovi3_ddoannh-fullview.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NDUwIiwicGF0aCI6IlwvZlwvODQ2YTkwODYtOGE0MC00M2UwLWFhMTAtMmZjN2Q2ZDczNzMwXC9kZG9hbm5oLTJlMDc5YzdmLTE3ZWMtNDIyZC05YmYxLWE3YzE1ZGI0NzUzMC5qcGciLCJ3aWR0aCI6Ijw9ODAwIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0.-alTR5r3ixCs1VZKvzSPR8ip_9glTSb9Xl_fo6-aeUI",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "No Time to Die",
      "image": "https://preview.redd.it/5zi82yd1tqg41.jpg?width=1080&crop=smart&auto=webp&s=29537a90c21c607863af82ab21478dce34b05231",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    },
    {
      "title": "Spider-Man: No Way Home",
      "image": "https://wallpapers.com/images/high/spider-man-no-way-home-background-mcg8r3eg84os1zue.webp",
      "addButton": "https://img.icons8.com/?size=100&id=37839&format=png&color=000000",
      "playButton": "https://img.icons8.com/?size=100&id=K6e875IFwuIm&format=png&color=000000"
    }
  ]
}

const favorites = [];

/**
 * @typedef {Object} Movie
 * @property {string} title - The title of the movie
 * @property {string} image - The image src URL for the movie
 */
    
/**
 * This function filters movies by a given query.
 * It uses the query to check if any of the existing movies in the dataset match the query in some way.
 * 
 * @param {string} query - The query string to match against
 * @returns {Record<string, Movie[]>} - The filtered movies by category (as key -> category, value -> movies)
 */
function filterMovies(query) {
    // if no query was passed, use the default dataset
    if (!query) {
      return data;
    }

    const filteredMovies = {};

    // Loop through each category
    Object.keys(data).forEach(category => {
        const movies = data[category];
        const filteredCategoryMovies = movies.filter(movie => 
            movie.title.toLowerCase().includes(query.toLowerCase())
        );

        filteredMovies[category] = filteredCategoryMovies;
    });

    return filteredMovies;
}

function getFavorites() {
  return JSON.parse(localStorage.getItem(favoritesStorageKey)) || [];
}

const favoritesStorageKey = 'favoriteMovies';

function setFavorites(movies) {
  localStorage.setItem(favoritesStorageKey, JSON.stringify(movies));
}

function updateButtonVisibility(isFavorite, addButt, removeButt) {
  addButt.style.display = isFavorite ? 'none' : 'block';   // Show/hide Add button
  removeButt.style.display = isFavorite ? 'block' : 'none';
}

function renderMovies(movies) {
  // item template for cloning purposes
  const itemTemplate = document.getElementById("movieTemplateItem");

  for (const category in movies) {
    const row = document.getElementById(category);

    if (!row) {
      console.error(`Row with ID '${category}' not found`);
      return; 
    }

    const movieList = row.querySelector('ul')

    // empty the list so we can append new items or remove filtered ones
    movieList.innerHTML = '';

    if (!movies[category].length) {
      movieList.innerHTML = '<div style="font-size: 18px; font-weight: 700;">No results found. 🥺</div>'
    } 

    movies[category].forEach(movie => {
      // clone the list item from the template
      const movieTemplate = itemTemplate.content.cloneNode(true);
      const movieEl = movieTemplate.querySelector('li');

      const isFavorite = favorites.find(favorite => favorite.id === movie.id);

      if (isFavorite) {
        movieEl.classList.add('favorite');
      }
      else {
        movieEl.classList.remove('favorite');
      }

      const imgEl = movieEl.querySelector('img');
      // add necessary info to img tag
      imgEl.alt = movie.title;
      imgEl.src = movie.image;

      const addButt = movieTemplate.querySelector('.addButton');
      const removeButt = movieTemplate.querySelector('.removeButton');
      
      updateButtonVisibility(isFavorite, addButt, removeButt);
      
    //   function updateButtonVisibility(isFavorite) {
    //     if (isFavorite) {
    //         addButt.style.display = 'none';   
    //         removeButt.style.display = 'block'; 
    //     } else {
    //         addButt.style.display = 'block';  
    //         removeButt.style.display = 'none'; 
    //     }
    // }

    // updateButtonVisibility(isFavorite);

      // addButt.addEventListener('click', () => {
      //   favorites.unshift(movie);
      //   setFavorites(favorites);

      //   alert(`${movie.title} has been added to your list`);

      //   updateButtonVisibility(true);

      //   // movieList.appendChild(movieTemplate); // Append the updated movie template
      // });

    //   
    
    addButt.addEventListener('click', () => {
      favorites.unshift(movie); // Add to favorites
      setFavorites(favorites); // Update local storage
      alert(`${movie.title} has been added to your list`);

      // Render movies again to reflect the updated favorites
      renderMovies({
          [category]: movies[category],
          myList: getFavorites(),
      });
  });

  // Add event listener for the remove button
  removeButt.addEventListener('click', () => {
      const filteredFavorites = favorites.filter(favorite => favorite.id !== movie.id);
      setFavorites(filteredFavorites); // Update local storage
      alert(`${movie.title} has been removed from your list`);

      // Render movies again to reflect the updated favorites
      renderMovies({
          [category]: movies[category],
          myList: getFavorites(),
      });
  });

      movieList.appendChild(movieTemplate);

    //   console.log(movie);
    })
  } 
}


// render the initial page
renderMovies(data);
